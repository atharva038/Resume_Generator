<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resume Classifier - ML Service Test</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .status-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        font-weight: 600;
        margin-top: 10px;
      }

      .status-badge.ready {
        background: #10b981;
      }

      .status-badge.error {
        background: #ef4444;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
      }

      textarea {
        width: 100%;
        min-height: 200px;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        font-family: monospace;
        resize: vertical;
      }

      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .char-count {
        text-align: right;
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
      }

      button {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 10px;
        transition: transform 0.2s;
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .loading {
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 4px solid #f3f4f6;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .result-card {
        margin-top: 20px;
      }

      .predicted-category {
        text-align: center;
        padding: 30px;
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border-radius: 12px;
        margin-bottom: 20px;
      }

      .predicted-category h2 {
        font-size: 2rem;
        color: #1f2937;
        margin-bottom: 10px;
      }

      .confidence-circle {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 20px auto;
      }

      .confidence-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
      }

      .confidence-text .value {
        font-size: 28px;
        font-weight: bold;
        color: #667eea;
      }

      .confidence-text .label {
        font-size: 12px;
        color: #6b7280;
      }

      .prediction-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .prediction-item:last-child {
        border-bottom: none;
      }

      .prediction-name {
        font-weight: 600;
        color: #374151;
      }

      .prediction-confidence {
        font-weight: bold;
        color: #667eea;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #f3f4f6;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.5s ease;
      }

      .sample-btn {
        background: #f3f4f6;
        color: #374151;
        font-size: 14px;
        padding: 8px 16px;
        width: auto;
        display: inline-block;
        margin: 5px;
      }

      .sample-btn:hover {
        background: #e5e7eb;
      }

      .info-box {
        background: #eff6ff;
        border-left: 4px solid #3b82f6;
        padding: 16px;
        border-radius: 8px;
        margin-top: 20px;
      }

      .info-box p {
        color: #1e40af;
        font-size: 14px;
        line-height: 1.6;
      }

      .medal {
        font-size: 20px;
        margin-right: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>ü§ñ Resume Category Classifier</h1>
        <p>Real ML Model - scikit-learn Random Forest</p>
        <div id="status-badge" class="status-badge">Checking ML Service...</div>
      </div>

      <!-- Input Card -->
      <div class="card">
        <label for="resume-text">Paste Resume Text Here</label>
        <textarea
          id="resume-text"
          placeholder="Paste your resume content here (minimum 50 characters)...&#10;&#10;Example:&#10;Software Engineer with 5 years of experience in full-stack development.&#10;Expert in JavaScript, React, Node.js, Python, and AWS.&#10;Built scalable web applications serving millions of users..."
        ></textarea>
        <div class="char-count" id="char-count">0 characters</div>

        <div style="margin-top: 20px">
          <strong>Quick Test Samples:</strong><br />
          <button class="sample-btn" onclick="loadSample('software')">
            Software Engineer
          </button>
          <button class="sample-btn" onclick="loadSample('data')">
            Data Scientist
          </button>
          <button class="sample-btn" onclick="loadSample('hr')">
            HR Professional
          </button>
        </div>

        <button id="classify-btn" onclick="classifyResume()">
          üß† Classify Resume Category
        </button>
      </div>

      <!-- Loading State -->
      <div id="loading" class="card loading" style="display: none">
        <div class="spinner"></div>
        <p style="color: #6b7280">Analyzing resume with ML model...</p>
      </div>

      <!-- Results Card -->
      <div id="result" class="card result-card" style="display: none">
        <div class="predicted-category">
          <p style="color: #6b7280; font-size: 14px; margin-bottom: 5px">
            PREDICTED CATEGORY
          </p>
          <h2 id="category-name">--</h2>

          <div class="confidence-circle">
            <svg width="120" height="120">
              <circle
                cx="60"
                cy="60"
                r="54"
                stroke="#e5e7eb"
                stroke-width="8"
                fill="none"
              />
              <circle
                id="confidence-circle"
                cx="60"
                cy="60"
                r="54"
                stroke="#667eea"
                stroke-width="8"
                fill="none"
                stroke-dasharray="339.292"
                stroke-dashoffset="339.292"
                transform="rotate(-90 60 60)"
                stroke-linecap="round"
              />
            </svg>
            <div class="confidence-text">
              <div class="value" id="confidence-value">0%</div>
              <div class="label">Confidence</div>
            </div>
          </div>
        </div>

        <h3 style="margin-bottom: 15px; color: #374151">
          üìä Top 3 Predictions
        </h3>
        <div id="predictions-list"></div>

        <div class="info-box">
          <p>
            <strong>‚ÑπÔ∏è How it works:</strong> This model uses a Random Forest
            classifier trained on <span id="category-count">25</span> job
            categories with 98%+ accuracy. It analyzes your resume text using
            TF-IDF vectorization to predict the most likely job category.
          </p>
        </div>
      </div>
    </div>

    <script>
      const API_URL = "http://localhost:5001";
      let availableCategories = [];

      // Sample resumes
      const samples = {
        software: `Software Engineer with 5 years of experience in full-stack web development.
Expert in JavaScript, React, Node.js, Python, and AWS cloud services.
Built and maintained scalable web applications serving millions of users.
Strong background in RESTful API design, database optimization, and microservices architecture.
Proficient in Git, Docker, CI/CD pipelines, and agile methodologies.
Led development teams and mentored junior developers.
Bachelor's degree in Computer Science.`,

        data: `Data Scientist with 4 years of experience in machine learning and analytics.
Proficient in Python, TensorFlow, PyTorch, scikit-learn, and SQL.
Developed predictive models for customer churn, recommendation systems, and fraud detection.
Experience with data visualization tools like Tableau and PowerBI.
Strong background in statistical analysis, A/B testing, and experiment design.
Expertise in deep learning, natural language processing, and computer vision.
Published research papers in ML conferences.
Master's degree in Data Science.`,

        hr: `Human Resources Manager with 6 years of experience in talent acquisition and employee relations.
Skilled in full-cycle recruitment, onboarding, and performance management.
Managed teams of 50+ employees and reduced employee turnover by 30%.
Experience with HRIS systems, payroll, and benefits administration.
Strong knowledge of labor laws, compliance, and HR policies.
Excellent communication, conflict resolution, and interpersonal skills.
Led diversity and inclusion initiatives.
Bachelor's degree in Human Resources Management.`,
      };

      // Load sample
      function loadSample(type) {
        document.getElementById("resume-text").value = samples[type];
        updateCharCount();
      }

      // Update character count
      const textarea = document.getElementById("resume-text");
      const charCount = document.getElementById("char-count");

      textarea.addEventListener("input", updateCharCount);

      function updateCharCount() {
        const count = textarea.value.length;
        charCount.textContent = `${count} characters`;
        charCount.style.color = count < 50 ? "#ef4444" : "#10b981";
      }

      // Check ML service status
      async function checkMLService() {
        const statusBadge = document.getElementById("status-badge");

        try {
          const response = await fetch(`${API_URL}/health`);
          const data = await response.json();

          if (data.status === "healthy" && data.model_loaded) {
            statusBadge.textContent = "‚úÖ ML Service Ready";
            statusBadge.className = "status-badge ready";
            loadCategories();
          } else {
            statusBadge.textContent = "‚ö†Ô∏è Model Not Loaded";
            statusBadge.className = "status-badge error";
          }
        } catch (error) {
          statusBadge.textContent =
            "‚ùå ML Service Offline (Run: python3 app.py)";
          statusBadge.className = "status-badge error";
        }
      }

      // Load categories
      async function loadCategories() {
        try {
          const response = await fetch(`${API_URL}/categories`);
          const data = await response.json();
          availableCategories = data.categories || [];
          document.getElementById("category-count").textContent =
            availableCategories.length;
        } catch (error) {
          console.error("Failed to load categories:", error);
        }
      }

      // Classify resume
      async function classifyResume() {
        const resumeText = textarea.value.trim();

        if (resumeText.length < 50) {
          alert("Please enter at least 50 characters");
          return;
        }

        // Show loading
        document.getElementById("loading").style.display = "block";
        document.getElementById("result").style.display = "none";
        document.getElementById("classify-btn").disabled = true;

        try {
          const response = await fetch(`${API_URL}/predict`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              resume_text: resumeText,
            }),
          });

          const result = await response.json();

          if (result.success) {
            displayResult(result.data);
          } else {
            alert("Error: " + result.error);
          }
        } catch (error) {
          alert(
            "Failed to classify resume. Make sure ML service is running on port 5001."
          );
          console.error("Classification error:", error);
        } finally {
          document.getElementById("loading").style.display = "none";
          document.getElementById("classify-btn").disabled = false;
        }
      }

      // Display result
      function displayResult(data) {
        document.getElementById("result").style.display = "block";
        document.getElementById("category-name").textContent =
          data.predicted_category;
        document.getElementById("confidence-value").textContent =
          data.confidence.toFixed(1) + "%";

        // Animate confidence circle
        const circle = document.getElementById("confidence-circle");
        const circumference = 339.292;
        const offset = circumference - (data.confidence / 100) * circumference;
        circle.style.strokeDashoffset = offset;

        // Display top predictions
        const predictionsList = document.getElementById("predictions-list");
        predictionsList.innerHTML = "";

        const medals = ["ü•á", "ü•à", "ü•â"];

        data.top_predictions.forEach((pred, index) => {
          const item = document.createElement("div");
          item.className = "prediction-item";

          item.innerHTML = `
                    <div>
                        <span class="medal">${medals[index]}</span>
                        <span class="prediction-name">${pred.category}</span>
                    </div>
                    <span class="prediction-confidence">${pred.confidence.toFixed(
                      2
                    )}%</span>
                `;

          const progressBar = document.createElement("div");
          progressBar.className = "progress-bar";
          progressBar.innerHTML = `<div class="progress-fill" style="width: ${pred.confidence}%"></div>`;

          item.appendChild(progressBar);
          predictionsList.appendChild(item);
        });

        // Scroll to result
        document.getElementById("result").scrollIntoView({behavior: "smooth"});
      }

      // Check service on load
      checkMLService();
    </script>
  </body>
</html>
